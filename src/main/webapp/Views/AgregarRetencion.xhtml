<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./../Plantilla/Plantilla.xhtml">

            <ui:define name="content">
                <p:growl id="growl" widgetVar="growl" showDetail="true" life="2000"/> 
                <div style="font-weight: bold; background-color: #036fab; 
                     color: white; text-align: center; height: 25px;">
                    <h2>AGREGAR RETENCIONES</h2>
                </div>
                <p:panel>
                    <div class="ui-datatable ui-widget">
                        <h:form>
                            <div class="ui-grid-row" style="height: 135px;">
                                <div>
                                    <div style="float: left;">
                                        <p:outputLabel value="Cliente: "
                                                       style="font-weight:bold;"/>
                                        <br/> <br/>
                                        <p:selectOneMenu id="optionClientes" style="width: 300px; height: 40px;"> 
                                            <f:selectItem itemLabel="Seleccione..." itemValue=""/>
                                            <f:selectItems value="#{retencionController.listaCliente}" var="c" itemLabel="#{c.description}" itemValue="#{c.label}"/>
                                        </p:selectOneMenu>
                                    </div>
                                    <div style="float: left; padding-left: 100px;">
                                        <p:outputLabel value="N° Factura: " style="font-weight:bold;" />
                                        <br/> <br/>
                                        <p:selectOneMenu id="option" style="width: 200px; height: 40px;">                            
                                            <f:selectItem itemLabel="Seleccione..." itemValue=""/>
                                            <f:selectItems value="#{retencionController.listaVentas}"/>
                                        </p:selectOneMenu>
                                    </div>
                                </div>
                                <div>
                                    <div style="height: 133px; width: 250px;
                                         float: left; padding-left: 100px;">
                                        <p:outputLabel value="Fecha Emisión: " for="fecha" 
                                                       style="font-weight:bold;"/>
                                        <br/> <br/> 
                                        <p:datePicker id="fecha" readonly="true"
                                                      style="width: 150px;"
                                                      placeholder="dd/mm/aaaa"
                                                      value="#{retencionController.retencion.fecha_Emision}"/>
                                    </div>
                                </div>
                            </div>

                            <div>     
                                <p:commandButton icon="pi pi-replay " value="Cargar Retención" 
                                                 styleClass=" ui-button-secondary" 
                                                 style="margin:.3rem;"/>
                                <p:commandButton icon="pi pi-plus " value="Añadir Nueva Retención" 
                                                 onclick="PF('RetencionNew').show()"
                                                 styleClass=" ui-button-success" 
                                                 style="margin:.3rem;"/>
                            </div>
                            <br/>
                        </h:form>
                        <div class="card">
                            <h:form id="form">
                                <p:dataTable id="tblRetenciones" var="varRetenciones" 
                                             value="#{retencionController.listaRetenciones}" 
                                             style="font-size: 12px;" >
                                    <p:column headerText="Ejercicio Fiscal" 
                                              style="text-align: center;">
                                        <h:outputText value="#{varRetenciones.ejerFiscal}" />
                                    </p:column>
                                    <p:column headerText="Base Imponible" 
                                              style="text-align: center;">
                                        <h:outputText value="#{varRetenciones.baseImponible}" />
                                    </p:column>
                                    <p:column headerText="Descripción Impuesto" 
                                              style="text-align: center;">
                                        <h:outputText value="#{varRetenciones.descImpuesto}" />
                                    </p:column>
                                    <p:column headerText="% Retención" 
                                              style="text-align: center;">
                                        <h:outputText value="#{varRetenciones.porcen_Retencion}" />
                                    </p:column>
                                    <p:column headerText="Valor Retenido" 
                                              style="text-align: center;">
                                        <h:outputText value="#{varRetenciones.valorRetenido}" />
                                    </p:column>
                                    <p:column style="text-align: center; width: 150px;" headerText="Acciones">
                                        <p:commandButton action="#{retencionController.btnEditar(varRetenciones.id_Retencion)}"
                                                         update="tblRetenciones" ajax="true"
                                                         oncomplete="PF('RetencionEdit').show()"
                                                         style="width: 35px; height: 30px;" 
                                                         icon="pi pi-pencil"/> 
                                        <p:commandButton update="tblRetenciones" ajax="true"
                                                         style="width: 35px; height: 30px;" 
                                                         styleClass="ui-button-danger" 
                                                         icon="pi pi-times-circle"/>
                                    </p:column>
                                </p:dataTable>
                            </h:form>
                        </div>

                        <!-- Ventana Agregar datos de la retencion!-->
                        <p:dialog header="Nueva Retención" minHeight="50" 
                                  height="auto" width="680px" showEffect="fade"
                                  modal="true" widgetVar="RetencionNew">
                            <h:form>
                                <p:outputPanel>
                                    <div class="p-field p-col-12 p-md-3">
                                        <label style="font-weight: bold; padding-left: 57px;">
                                            Base Imponible<label style="color: red;">*</label>: 
                                        </label>
                                        <p:inputText id="baseImponible"
                                                     type="number" 
                                                     style="width: 80px; 
                                                     margin: 3px;"
                                                     value="#{retencionController.retencion.baseImponible}">

                                        </p:inputText>
                                        <label>$</label>

                                        <label style="font-weight: bold; padding-left: 45px">
                                            Descripción Impuesto<label style="color: red;">*</label>:
                                        </label>
                                        <p:inputText id="descrImpuesto"
                                                     type="text"
                                                     style="width: 100px;  
                                                     margin: 3px;"
                                                     value="#{retencionController.retencion.descImpuesto}"/> 
                                    </div>
                                    <br/>
                                    <div class="p-field p-col-12 p-md-3">
                                        <label style="font-weight: bold; padding-left: 23px;">
                                            Porcentaje Retenido<label style="color: red;">*</label>: 
                                        </label>
                                        <p:inputText id="porcRetenido"
                                                     maxlength="3"
                                                     type="number" 
                                                     style="width: 50px; 
                                                     margin: 3px;"
                                                     value="#{retencionController.retencion.porcen_Retencion}"/> 
                                        <label>%</label>
                                    </div>
                                </p:outputPanel>
                                <br/>
                                <div style="float: right;">
                                    <p:commandButton icon="pi pi-times" value="Cancelar"
                                                     onclick="PF('RetencionNew').hide()"
                                                     class="ui-button-secondary"
                                                     styleClass=" ui-button-danger"/> 
                                    <p:commandButton action="#{retencionController.registrarRetencion()}"
                                                     ajax="false" update=":tblRetenciones"
                                                     icon="pi pi-save" value="Aplicar"
                                                     styleClass=" ui-button-success"/> 
                                </div>
                            </h:form>
                        </p:dialog>

                        <!-- Ventana Editar datos de la retencion!-->
                        <p:dialog header="Editar Retención" minHeight="50" 
                                  height="auto" width="680px" showEffect="fade"
                                  modal="true" widgetVar="RetencionEdit">
                            <h:form>
                                <p:outputPanel>
                                    <div class="p-field p-col-12 p-md-3">
                                        <label style="font-weight: bold; padding-left: 57px;">
                                            Base Imponible<label style="color: red;">*</label>: 
                                        </label>
                                        <p:inputText id="baseImponible"
                                                     type="text" 
                                                     style="width: 80px; 
                                                     margin: 3px;"
                                                     value="#{retencionController.retencion.baseImponible}"/>
                                        <label>$</label>

                                        <label style="font-weight: bold; padding-left: 45px">
                                            Descripción Impuesto<label style="color: red;">*</label>:
                                        </label>
                                        <p:inputText id="descrImpuesto"
                                                     type="text" 
                                                     style="width: 100px;  
                                                     margin: 3px;"
                                                     value="#{retencionController.retencion.descImpuesto}"/> 
                                    </div>
                                    <br/>
                                    <div class="p-field p-col-12 p-md-3">
                                        <label style="font-weight: bold; padding-left: 23px;">
                                            Porcentaje Retenido<label style="color: red;">*</label>: 
                                        </label>
                                        <p:inputText id="porcRetenido"
                                                     maxlength="3"
                                                     type="text" 
                                                     style="width: 50px; 
                                                     margin: 3px;"
                                                     value="#{retencionController.retencion.porcen_Retencion}"/> 
                                        <label>%</label>
                                    </div>
                                </p:outputPanel>
                                <br/>
                                <div style="float: right;">
                                    <p:commandButton icon="pi pi-times" value="Cancelar"
                                                     onclick="PF('RetencionEdit').hide()"
                                                     class="ui-button-secondary"
                                                     styleClass=" ui-button-danger"/> 
                                    <p:commandButton action="#{retencionController.actualizarRetencion()}"
                                                     ajax="false"
                                                     icon="pi pi-save" value="Guardar Cambios"
                                                     styleClass=" ui-button-success"/> 
                                </div>
                            </h:form>
                        </p:dialog>
                    </div> 
                </p:panel>
            </ui:define>

        </ui:composition>

    </body>
</html>
